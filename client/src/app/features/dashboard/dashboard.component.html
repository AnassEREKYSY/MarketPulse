<!-- Welcome Section -->
<div class="welcome-section">
  <div class="welcome-content">
    <div class="welcome-text-top">
      <h1 class="main-title">MarketPulse Jobs</h1>
      <p class="subtitle">Your Gateway to Job Market Intelligence</p>
      <p class="description">
        Discover real-time job opportunities, salary insights, and market trends. 
        Search thousands of job listings and get comprehensive analytics.
      </p>
    </div>
    
    <!-- Search Bar - Center -->
    <div class="search-section">
      <div class="search-container">
        <form [formGroup]="filtersForm" (ngSubmit)="onSearch()">
          <div class="search-box">
            <mat-icon class="search-icon">search</mat-icon>
            <input 
              matInput 
              type="text" 
              placeholder="Search jobs (e.g., Software Engineer, Data Analyst...)" 
              formControlName="query"
              (keyup.enter)="onSearch()"
              class="search-input">
            <input 
              matInput 
              type="text" 
              placeholder="Location (e.g., Paris, France)" 
              formControlName="location"
              (keyup.enter)="onSearch()"
              class="search-location">
            <button mat-raised-button color="primary" type="submit" [disabled]="searchLoading" class="search-button">
              <mat-icon *ngIf="!searchLoading">search</mat-icon>
              <mat-spinner *ngIf="searchLoading" diameter="20"></mat-spinner>
              Search
            </button>
          </div>
        </form>
      </div>
      
      <!-- Filters -->
      <div class="filters-container" [formGroup]="filtersForm">
        <div class="filters-grid">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Employment Type</mat-label>
            <mat-select formControlName="employmentType">
              <mat-option value="">All Types</mat-option>
              <mat-option *ngFor="let type of employmentTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Work Mode</mat-label>
            <mat-select formControlName="workMode">
              <mat-option value="">All Modes</mat-option>
              <mat-option *ngFor="let mode of workModes" [value]="mode">{{ mode }}</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Experience Level</mat-label>
            <mat-select formControlName="experienceLevel">
              <mat-option value="">All Levels</mat-option>
              <mat-option *ngFor="let level of experienceLevels" [value]="level">{{ level }}</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Min Salary (EUR/year)</mat-label>
            <input matInput type="number" formControlName="minSalary" placeholder="e.g., 30000">
          </mat-form-field>
          
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Max Salary (EUR/year)</mat-label>
            <input matInput type="number" formControlName="maxSalary" placeholder="e.g., 100000">
          </mat-form-field>
          
          <button mat-button (click)="clearFilters()" class="clear-button">
            <mat-icon>clear</mat-icon>
            Clear Filters
          </button>
        </div>
      </div>
      
      <!-- Heat Map - Only show after search -->
      <div class="heatmap-section" *ngIf="hasSearched">
        <mat-card class="heatmap-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>map</mat-icon>
              Job Locations Map
            </mat-card-title>
            <mat-form-field appearance="outline" class="map-type-selector">
              <mat-label>Map Type</mat-label>
              <mat-select formControlName="mapType">
                <mat-option value="jobs">Job Density</mat-option>
                <mat-option value="salary">Average Salary</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="heatMapLoading" class="map-loading">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Loading map data...</p>
            </div>
            <div #mapContainer id="heatmap-container" class="map-container" [style.display]="heatMapLoading ? 'none' : 'block'"></div>
            <div *ngIf="!heatMapLoading && searchResults && (!searchResults.jobs || searchResults.jobs.length === 0)" class="map-empty">
              <mat-icon>map</mat-icon>
              <p>No job locations available</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
    
    <div class="welcome-text-bottom">
      <p class="bottom-text">
        <span class="highlight">Real-time Analytics</span> • 
        <span class="highlight">Interactive Maps</span> • 
        <span class="highlight">Market Trends</span> • 
        <span class="highlight">Smart Search</span>
      </p>
    </div>
  </div>
</div>

<!-- Results Section - Only show after search -->
<div id="results-section" *ngIf="hasSearched && searchResults" class="results-section">
  <div class="container">
    <!-- Statistics Cards -->
    <div class="stats-section" *ngIf="statistics">
      <!-- Data Quality Warning -->
      <div *ngIf="dataQualityWarning" class="data-quality-warning">
        <mat-icon>warning</mat-icon>
        <span>{{ dataQualityWarning }}</span>
      </div>
      
      <div class="stats-grid">
        <app-stat-card
          title="Total Jobs"
          [value]="statistics.totalJobs || 0"
          icon="work_outline"
          color="primary">
        </app-stat-card>
        
        <app-stat-card
          title="Average Salary"
          [value]="getAverageSalary()"
          icon="payments"
          color="accent">
        </app-stat-card>
        
        <app-stat-card
          title="Companies"
          [value]="uniqueCompanies.length"
          icon="business_center"
          color="primary">
        </app-stat-card>
        
        <app-stat-card
          title="Locations"
          [value]="getTopLocationsCount()"
          icon="location_on"
          color="accent">
        </app-stat-card>
      </div>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section" *ngIf="statistics">
      <div class="charts-grid">
        <!-- Employment Type Column Chart -->
        <mat-card *ngIf="getEmploymentTypeChartData()" class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>bar_chart</mat-icon>
              Employment Type Distribution
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-chart [config]="getEmploymentTypeChartData()" [loading]="loading"></app-chart>
          </mat-card-content>
        </mat-card>
        
        <!-- Work Mode Column Chart -->
        <mat-card *ngIf="getWorkModeChartData()" class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>bar_chart</mat-icon>
              Work Mode Analysis
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-chart [config]="getWorkModeChartData()" [loading]="loading"></app-chart>
          </mat-card-content>
        </mat-card>
        
        <!-- Experience Level Column Chart -->
        <mat-card *ngIf="getExperienceLevelChartData()" class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>bar_chart</mat-icon>
              Experience Level Distribution
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-chart [config]="getExperienceLevelChartData()" [loading]="loading"></app-chart>
          </mat-card-content>
        </mat-card>
        
        <!-- Salary Bar Chart -->
        <mat-card *ngIf="getSalaryChartData()" class="chart-card chart-card-wide">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>bar_chart</mat-icon>
              Salary by Experience Level
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-chart [config]="getSalaryChartData()" [loading]="loading"></app-chart>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
    
    <!-- Companies Grid -->
    <div class="companies-section" *ngIf="uniqueCompanies.length > 0">
      <mat-card class="section-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>business_center</mat-icon>
            Companies ({{ uniqueCompanies.length }})
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="companies-grid">
            <mat-card *ngFor="let company of displayedCompanies; trackBy: trackByCompanyId" class="company-card">
              <mat-card-header>
                <div class="company-header">
                  <mat-icon class="company-icon">business</mat-icon>
                  <mat-card-title>{{ company.name }}</mat-card-title>
                </div>
              </mat-card-header>
              <mat-card-content>
                <div class="company-info">
                  <p class="company-industry" *ngIf="company.industry">
                    <mat-icon>domain</mat-icon>
                    {{ company.industry }}
                  </p>
                  <div class="company-job-count">
                    <mat-icon>work</mat-icon>
                    <span>{{ getCompanyJobCount(company.id) }} job{{ getCompanyJobCount(company.id) !== 1 ? 's' : '' }}</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          
          <!-- Show More Button -->
          <div class="show-more-container" *ngIf="hasMoreCompanies() && !showAllCompanies">
            <button mat-raised-button color="primary" (click)="showMoreCompanies()" class="show-more-button">
              <mat-icon>expand_more</mat-icon>
              Show More Companies ({{ uniqueCompanies.length - companiesToShow }} remaining)
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- Jobs List with Pagination -->
    <div class="jobs-section" *ngIf="displayedJobs && displayedJobs.length > 0">
      <mat-card class="section-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>work</mat-icon>
            Job Listings ({{ totalJobsCount }})
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="jobs-list">
            <mat-card *ngFor="let job of displayedJobs; trackBy: trackByJobId" class="job-card">
              <mat-card-header>
                <mat-card-title>{{ job.title }}</mat-card-title>
                <mat-card-subtitle>
                  <span *ngIf="job.company?.name">{{ job.company.name }}</span>
                  <span *ngIf="job.location?.city"> • {{ job.location.city }}</span>
                  <span *ngIf="job.location?.country">, {{ job.location.country }}</span>
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="job-meta">
                  <mat-chip *ngIf="job.employmentType" class="job-chip">
                    <mat-icon>work</mat-icon>
                    {{ job.employmentType }}
                  </mat-chip>
                  <mat-chip *ngIf="job.workMode" class="job-chip">
                    <mat-icon>location_on</mat-icon>
                    {{ job.workMode }}
                  </mat-chip>
                  <mat-chip *ngIf="job.experienceLevel" class="job-chip">
                    <mat-icon>trending_up</mat-icon>
                    {{ job.experienceLevel }}
                  </mat-chip>
                  <mat-chip *ngIf="job.salaryRange?.averageSalary" class="job-chip salary-chip">
                    <mat-icon>payments</mat-icon>
                    {{ job.salaryRange?.averageSalary | number }}€/year
                  </mat-chip>
                </div>
                <p *ngIf="job.description" class="job-description">
                  {{ (job.description | slice:0:200) }}...
                </p>
              </mat-card-content>
              <mat-card-actions>
                <a mat-button color="primary" [href]="job.sourceUrl" target="_blank" *ngIf="job.sourceUrl">
                  View Details
                  <mat-icon>open_in_new</mat-icon>
                </a>
              </mat-card-actions>
            </mat-card>
          </div>
          
          <!-- Pagination -->
          <mat-paginator
            [length]="totalJobsCount"
            [pageSize]="pageSize"
            [pageIndex]="pageIndex"
            [pageSizeOptions]="[10, 20, 50, 100]"
            (page)="onPageChange($event)"
            showFirstLastButtons
            aria-label="Select page of job results">
          </mat-paginator>
        </mat-card-content>
      </mat-card>
    </div>
    
    <!-- No Results -->
    <div *ngIf="searchResults && searchResults.jobs && searchResults.jobs.length === 0" class="no-results">
      <mat-icon>search_off</mat-icon>
      <h3>No jobs found</h3>
      <p>Try adjusting your search criteria</p>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="searchLoading" class="loading-overlay">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Searching jobs...</p>
</div>
